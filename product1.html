<html>

<head>


    <title>s n a i l f a r m</title>

    <link rel="stylesheet" type="text/css" href="productStyles.css">

</head>

<body>

    <div id="main">

        <a id="logoContainer" href="index.html">
            <img id="logo" src="https://d8a8qkbr68bun.cloudfront.net/sflgo.jpg" height="169" width="169" />
        </a>

        <div id="product">
            <img class="pic" src="https://d8a8qkbr68bun.cloudfront.net/waly_front_photo.jpg" />
            <p class="title">LINGERING YOUTH</p>
            <div id="blurbBuy">
                <p>
                    By Waly<br>
                    <br>
                    28 pages<br>
                    red and blue color Risograph<br>
                    Published in 2017<br>
                    Edition of 100
                </p>
                <a id="buyContainer" onclick="addToCart()">
                    <img id="buy" src="https://d8a8qkbr68bun.cloudfront.net/buyButton.jpg" />
                </a>
            </div>
            <img class="pic-wide" src="https://s3.us-east-2.amazonaws.com/snailfarm/insides/waly+inside+photo.jpg" />
            <img class="pic" src="https://s3.us-east-2.amazonaws.com/snailfarm/insides/waly+back+photo.jpg" />
        </div>

        <div id="spacer"></div>

    </div>
    <div id="float">
        <a href="mailto:jackson@jacksonepstein">jackson@jacksonepstein // </a>
        <a href="https://www.instagram.com/snail.farm/">instagram // </a>
        <a>2017</a>
    </div>
    <div id="cartFloat">
        <a>${cartNumber}</a>
    </div>

    <script src="https://sdks.shopifycdn.com/js-buy-sdk/v0/latest/shopify-buy.umd.polyfilled.min.js"></script>
    <script>

        const shopClient = ShopifyBuy.buildClient({
            accessToken: 'a7d7c34d7e531268037a004428ba7c93',
            domain: 'snailfarm.myshopify.com',
            appId: '6'
        });


        var cart;
        var product;
        var cartNumber;

        shopClient.fetchRecentCart()
            .then(function(recentCart) {
                cart = recentCart;
                //todo: function to get total number in cart in this console.log

                console.log(recentCart.attrs.line_items.reduce(function(result, item) {
                    return result += item.quantity;
                }, 0));

                // todo: how to interpolate this into the html
               cartNumber = recentCart.attrs.line_items.reduce(function(result, item) {
                    return result += item.quantity;
                }, 0);
            })
            .catch(function () {
                console.log('cart fetch failed');
            });

        shopClient.fetchProduct('10378973769')
            .then(function (fetchedProduct) {
                const variant = fetchedProduct.variants[0];
                const quantity = 1;
                product = { variant: variant, quantity: quantity };
            })
            .catch(function () {
                console.log('product fetch failed');
            });

        console.log('cart', cart)
        console.log('product', product);

        function addToCart() {
            cart.createLineItemsFromVariants(product)
                .then(function(cart) {
                    console.log('cart', cart);
                })
                .catch(function() {
                    console.log('onclick failed');
                });
        }

    </script>

</body>

</html>
